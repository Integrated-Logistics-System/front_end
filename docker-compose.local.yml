# ğŸ  ë¡œì»¬ ê°œë°œìš© Docker Compose (localhost ë°±ì—”ë“œ)
version: '3.8'

services:
  # Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ & ë¡œë“œë°¸ëŸ°ì„œ (ë¡œì»¬ìš©)
  nginx:
    image: nginx:1.25-alpine
    container_name: recipe-ai-nginx-local
    ports:
      - "81:80"      # HTTP (80ë²ˆì€ DSMì´ ì‚¬ìš© ì¤‘)
    volumes:
      # Nginx ì„¤ì • íŒŒì¼ (ë¡œì»¬ìš©)
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d/local.conf:/etc/nginx/conf.d/default.conf:ro
      
      # Static íŒŒì¼ ì§ì ‘ ì„œë¹™
      - ./nginx/static:/usr/share/nginx/html/static:ro
      
      # ë¡œê·¸ ì €ì¥
      - ./nginx/logs:/var/log/nginx
    
    environment:
      NGINX_WORKER_PROCESSES: auto
      NGINX_WORKER_CONNECTIONS: 1024
    
    depends_on:
      - frontend
    
    restart: unless-stopped
    
    networks:
      - recipe-ai-local-network
    
    # Docker Desktopì˜ host.docker.internal ì§€ì›
    extra_hosts:
      - "host.docker.internal:host-gateway"

  # Next.js Frontend (ë¡œì»¬ìš©)
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: recipe-ai-frontend-local
    expose:
      - "3000"
    environment:
      NODE_ENV: production
      
      # API ì—°ê²° (ë¡œì»¬ ë°±ì—”ë“œ)
      NEXT_PUBLIC_API_URL: /api
      NEXT_PUBLIC_WS_URL: /ws
      
      NEXT_TELEMETRY_DISABLED: 1
    
    restart: unless-stopped
    
    networks:
      - recipe-ai-local-network
    
    # ë¡œì»¬ ë°±ì—”ë“œ ì—°ê²°ì„ ìœ„í•œ host ì„¤ì •
    extra_hosts:
      - "host.docker.internal:host-gateway"
    
    # í—¬ìŠ¤ì²´í¬
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  recipe-ai-local-network:
    driver: bridge

# ğŸ¯ ë¡œì»¬ ì‚¬ìš©ë²•:
# docker-compose -f docker-compose.local.yml up -d
# docker-compose -f docker-compose.local.yml logs -f