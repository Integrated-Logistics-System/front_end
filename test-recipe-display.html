<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Display Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .recipe-card {
            background: linear-gradient(135deg, #2d1b69, #1e3a8a);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #374151;
        }
        .recipe-meta {
            display: flex;
            gap: 16px;
            margin: 16px 0;
            flex-wrap: wrap;
        }
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 14px;
        }
        .ingredients {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin: 16px 0;
        }
        .ingredient {
            padding: 8px;
            background: rgba(34, 197, 94, 0.2);
            border-radius: 6px;
            font-size: 14px;
        }
        .steps {
            margin: 16px 0;
        }
        .step {
            display: flex;
            gap: 12px;
            margin: 12px 0;
            padding: 12px;
            background: rgba(249, 115, 22, 0.2);
            border-radius: 8px;
        }
        .step-number {
            background: #f97316;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        .nutrition {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        .nutrition-item {
            text-align: center;
            padding: 12px;
            background: rgba(168, 85, 247, 0.2);
            border-radius: 8px;
        }
        .nutrition-value {
            font-size: 18px;
            font-weight: bold;
            color: #a855f7;
        }
        .nutrition-label {
            font-size: 12px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <h1>🧪 Recipe Data Display Test</h1>
    
    <div class="recipe-card" id="recipeCard">
        <h2 id="recipeTitle">로딩 중...</h2>
        
        <div class="recipe-meta" id="recipeMeta">
            <!-- 메타 정보가 여기에 표시됩니다 -->
        </div>
        
        <h3>🥕 필요한 재료</h3>
        <div class="ingredients" id="ingredients">
            <!-- 재료가 여기에 표시됩니다 -->
        </div>
        
        <h3>📋 조리 방법</h3>
        <div class="steps" id="steps">
            <!-- 조리 단계가 여기에 표시됩니다 -->
        </div>
        
        <h3>🍎 영양 정보</h3>
        <div class="nutrition" id="nutrition">
            <!-- 영양 정보가 여기에 표시됩니다 -->
        </div>
    </div>

    <script>
        // 백엔드 변환 로직을 시뮬레이션
        function transformElasticsearchRecipe(elasticsearchRecipe) {
            const steps = (elasticsearchRecipe.stepsKo && elasticsearchRecipe.stepsKo.length > 0) 
                          ? elasticsearchRecipe.stepsKo 
                          : (elasticsearchRecipe.steps && elasticsearchRecipe.steps.length > 0)
                          ? elasticsearchRecipe.steps
                          : (elasticsearchRecipe.stepsEn && elasticsearchRecipe.stepsEn.length > 0)
                          ? elasticsearchRecipe.stepsEn
                          : [];
            
            const ingredients = elasticsearchRecipe.ingredientsKo || elasticsearchRecipe.ingredients || [];
            
            // 조리시간 변환
            let cookingTime = 'N/A';
            if (elasticsearchRecipe.minutes && elasticsearchRecipe.minutes > 0) {
                cookingTime = `${elasticsearchRecipe.minutes}분`;
            }
            
            // 인분 정보 변환
            let servings = '2-3인분';
            const ingredientCount = elasticsearchRecipe.nIngredients || ingredients.length;
            const cookingMinutes = elasticsearchRecipe.minutes || 30;
            
            if (ingredientCount >= 8 || cookingMinutes >= 180) {
                servings = '4-6인분';
            } else if (ingredientCount >= 5 || cookingMinutes >= 60) {
                servings = '3-4인분';
            }
            
            // 영양정보 생성
            function estimateCalories(ingredientCount) {
                const baseCalories = 150 + (ingredientCount * 25);
                return `${baseCalories}kcal`;
            }
            
            function estimateProtein(ingredients) {
                const proteinIngredients = ingredients.filter(ing => 
                    ing.includes('돼지고기') || ing.includes('고기') || ing.includes('계란') || 
                    ing.includes('생선') || ing.includes('두부') || ing.includes('콩')
                );
                const protein = Math.max(5, proteinIngredients.length * 8);
                return `${protein}g`;
            }
            
            function estimateCarbs(ingredients) {
                const carbIngredients = ingredients.filter(ing =>
                    ing.includes('설탕') || ing.includes('밥') || ing.includes('면') || 
                    ing.includes('빵') || ing.includes('감자') || ing.includes('고구마')
                );
                const carbs = Math.max(10, carbIngredients.length * 15 + ingredients.length * 3);
                return `${carbs}g`;
            }
            
            function estimateFat(ingredients) {
                const fatIngredients = ingredients.filter(ing =>
                    ing.includes('기름') || ing.includes('버터') || ing.includes('치즈') ||
                    ing.includes('견과') || ing.includes('아보카도')
                );
                const fat = Math.max(3, fatIngredients.length * 5 + ingredients.length * 1);
                return `${fat}g`;
            }
            
            const nutritionInfo = {
                calories: estimateCalories(ingredients.length),
                protein: estimateProtein(ingredients),
                carbs: estimateCarbs(ingredients),
                fat: estimateFat(ingredients),
            };
            
            return {
                title: elasticsearchRecipe.nameKo || elasticsearchRecipe.name || '레시피',
                cookingTime: cookingTime,
                difficulty: elasticsearchRecipe.difficulty || '보통',
                servings: servings,
                ingredients: ingredients,
                ingredientCount: elasticsearchRecipe.nIngredients || ingredients.length,
                steps: steps.map((step, index) => ({
                    step: index + 1,
                    instruction: step,
                })),
                nutritionInfo: nutritionInfo,
            };
        }
        
        // 실제 Elasticsearch 데이터 (방금 가져온 데이터)
        const sampleRecipe = {
            "nameKo": "크록팟 nc 풀드포크",
            "name": "crock pot nc pulled pork",
            "minutes": 510,
            "nIngredients": 13,
            "difficulty": "차별화",
            "ingredientsKo": [
                "양파", "갈색 설탕", "훈제 파프리카", "소금", "갈은 후추",
                "돼지고기 엉덩이살", "사이다 식초", "우스터셔 소스", "으깬 고춧가루",
                "설탕", "마른 겨자", "마늘 소금", "카옌 페퍼"
            ],
            "stepsKo": [
                "크록팟에 양파 넣기", "갈색 설탕 섞기", "파프리카", "소금과 후추",
                "로스트 위에 문지르기", "크록팟에 로스트 넣기", "식초 섞기",
                "우스터셔 소스", "고추 플레이크", "설탕", "머스타드",
                "마늘 소금과 카옌페퍼를 넣고 잘 섞기", "로스트 위에 혼합물 1/3 정도 뿌리기",
                "남은 혼합물을 덮어 냉장 보관하기", "로스트를 약불에서 8~10시간 조리하기",
                "고기와 양파 꺼내기", "양파 버리고 고기 잘게 찢기",
                "크록팟에서 나온 육즙과 남은 식초 혼합물 넣기", "그대로 또는 샌드위치로 제공하기",
                "강불에서 4시간"
            ]
        };
        
        // 변환 및 표시
        const transformedRecipe = transformElasticsearchRecipe(sampleRecipe);
        
        // UI 업데이트
        document.getElementById('recipeTitle').textContent = transformedRecipe.title;
        
        // 메타 정보 표시
        const metaContainer = document.getElementById('recipeMeta');
        metaContainer.innerHTML = `
            <div class="meta-item">
                <span>⏰</span>
                <span>${transformedRecipe.cookingTime}</span>
            </div>
            <div class="meta-item">
                <span>👥</span>
                <span>${transformedRecipe.servings}</span>
            </div>
            <div class="meta-item">
                <span>🔥</span>
                <span>${transformedRecipe.difficulty}</span>
            </div>
            <div class="meta-item">
                <span>🥕</span>
                <span>${transformedRecipe.ingredientCount}개 재료</span>
            </div>
        `;
        
        // 재료 표시
        const ingredientsContainer = document.getElementById('ingredients');
        ingredientsContainer.innerHTML = transformedRecipe.ingredients
            .map(ingredient => `<div class="ingredient">✓ ${ingredient}</div>`)
            .join('');
        
        // 조리 단계 표시
        const stepsContainer = document.getElementById('steps');
        stepsContainer.innerHTML = transformedRecipe.steps
            .map(step => `
                <div class="step">
                    <div class="step-number">${step.step}</div>
                    <div>${step.instruction}</div>
                </div>
            `).join('');
        
        // 영양 정보 표시
        const nutritionContainer = document.getElementById('nutrition');
        nutritionContainer.innerHTML = `
            <div class="nutrition-item">
                <div class="nutrition-value">${transformedRecipe.nutritionInfo.calories}</div>
                <div class="nutrition-label">칼로리</div>
            </div>
            <div class="nutrition-item">
                <div class="nutrition-value">${transformedRecipe.nutritionInfo.protein}</div>
                <div class="nutrition-label">단백질</div>
            </div>
            <div class="nutrition-item">
                <div class="nutrition-value">${transformedRecipe.nutritionInfo.carbs}</div>
                <div class="nutrition-label">탄수화물</div>
            </div>
            <div class="nutrition-item">
                <div class="nutrition-value">${transformedRecipe.nutritionInfo.fat}</div>
                <div class="nutrition-label">지방</div>
            </div>
        `;
        
        console.log('🔍 변환된 레시피 데이터:', transformedRecipe);
    </script>
</body>
</html>